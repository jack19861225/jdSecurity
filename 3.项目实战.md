#项目实战

[9/Mar/2016:00:00:16 +0800] 222.171.7.89 - 62113 "http://cloud.insta360.com/post/5e7b029d8ed7e3c4b23006a71bab73c8?e=true&m=true" "GET http://cloud.insta360.com/public/media/mp4/5e7b029d8ed7e3c4b23006a71bab73c8_960x480.mp4" 206 509 20516390 HIT "Mozilla/5.0 (iPhone; CPU iPhone OS 8_4_1 like Mac OS X) AppleWebKit/600.1.4 (KHTML, like Gecko) Mobile/12H321 NewsApp/5.3.2" "video/mp4"

数据量：每年500亿条，集群需要保存3年的数据，其余数据归档，数据产生到服务器上，每个文件1G

带宽＝ 并发数（每5分钟）＊平均流量

项目背景：

    CDN作为互联网的核心发动引擎，承载这互联网的速度，建设好CDN项目以后，需要对数据进行，运营与把握，为此我们需要以大数据技术作为依托，开展大数据技术平台的搭建。

需求：

```
数据结构：

1.每个网站的流量包数据

有效流量包及过期流量包详情，包括类型、使用详情、购买/领取时间、过期时间、类型

2.每个网站的CDN日志数据结构：

请求时间、访问域名的客户端IP、被访问域名、文件请求路径、本次访问字节数大小、省份、运营商、http返回状态码、referer信息、request-time、User-Agent

3.CDN日志地区编码映射表

1：华北地区、2：西北地区、3：东北地区、4：华东地区、5：华中地区、6：西南地区、7：华南地区、8：其他地区；

4.CDN日志省份编码映射表
22：北京、86：内蒙古、146：山西、1069：河北、1177：天津、119：宁夏、152：陕西、1208：甘肃、1467：青海、1468：新疆、145：黑龙江、1445：吉林,、1464：辽宁、2：福建、120：江苏、121：安徽、122：山东、1050：上海、1442：浙江、182：河南、1135：湖北、1465：江西、1466：湖南、118：贵州、153：云南、1051：重庆、1068：四川、1155：西藏、4：广东、173：广西、1441：海南、0：其他、1：港澳台、-1：海外

5. CDN日志运营商编码映射表

2：中国电信、26：中国联通、43：长城宽带、1046：中国移动、3947：中国铁通；

```

业务需求：

```
使用量统计：支持分页，查询 时间不能超过5秒

1.查询最近90天内接入 CDN 的域名的使用量情况，可指定时间区间、域名、地域、运营商、时间粒度查询条件，可查询内容包括：

域名流量、带宽使用详情、峰值的查询、明细下载（支持所选时间区间5分钟细粒度明细）；，
流量使用运营商、省份 Top10 查询、下载；
流量/宽带使用 Top100 查询、下载。
访问情况统计：

2.查询最近90天内接入CDN的域名的访问情况，可指定时间区间、域名、地域、运营商、时间粒度查询条件，可查询内容包括：支持分页，查询 时间不能超过5秒

请求数量、IP访问次数、命中率；
请求数量的运营商、省份分布 Top10 查询、下载；
域名维度访问情况 Top10 查询、下载；
域名访问状况（资源URL维度）Top100查询、下载。

3.状态码统计：支持分页，查询 时间不能超过5秒
可查询最近90天内接入CDN的域名边缘节点或中间源状态码统计及分布，可指定时间区间、域名、时间粒度查询条件，可查询内容包括
2XX、3XX、4XX、5XX状态码统计图及明细下载；
状态码占比、数目情况及明细下载。

```

```
练习需求：

1.详细设计文档编写
  1.1 软件架构
  1.2 业务架构
  1.3 硬件选型
2.数据表结构设计
3.环境搭建，代码实现

```

